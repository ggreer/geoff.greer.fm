---
date: '2012-08-23 17:48:50'
layout: post
slug: ag-benchmarking-revisions
title: 'Ag: Benchmarking Revisions'
published: true
categories:
- Computers
- The Silver Searcher
---

I was curious about the performance of versions of Ag over time, so I benchmarked every revision from January to now.

<script type="text/javascript" src="https://www.google.com/jsapi"> </script>
<script type="text/javascript">
  // Load the Visualization API and the piechart package.
  google.load('visualization', '1.0', {'packages':['corechart']});

  // Set a callback to run when the Google Visualization API is loaded.
  google.setOnLoadCallback(drawChart);

  // Callback that creates and populates a data table,
  // instantiates the pie chart, passes in the data and
  // draws it.
  function drawChart() {
    // Create the data table.
    var data = new google.visualization.arrayToDataTable([
      ["Revision", "ag blahblahblah", "ag blah.*blah", "ag -i blahblahblah"],
      ["e344ca087099431c1bcf733b3ae28316f6932683", 1.948765, 2.282791, 1.950637],
      ["a87aa8f822d9029243423ef0725ec03ca347141b", 3.981451, 4.266946, 3.959043],
      ["4e73903f7033ae0808cc00a217c4608dd8da4931", 3.944441, 4.271839, 3.977377],
      ["5e9a49fcb1f998acd573eef42c40cbc312c4af3b", 3.955884, 4.265117, 3.959516],
      ["b64de8fbbf9f2ec35a4ab7f3369431f79c483217", 3.929699, 4.278663, 3.945001],
      ["ee0e507c67cabebe03d1f07b7b0d6099c1242979", 3.922079, 4.220613, 3.918369],
      ["f4cdbeb8e7aac3853687fbf653974bd610d462e5", 3.878047, 4.199441, 3.892196],
      ["f8a58c06106cee7222bfd8ba084dd3e788c33d65", 3.904567, 4.204908, 3.890956],
      ["227ad6ee106d0db55753caf68902b97a2d416408", 3.882248, 4.240623, 3.890136],
      ["8a843843e83c4cad8f53daa7e5b9564107ecd11e", 3.938665, 4.293881, 3.972416],
      ["bdc04e76f202bbfe39fe77356e30c29b27e5032c", 3.940819, 4.286703, 3.974053],
      ["f6199062f0ebf1e83802ad76f1dc0f621b0549e8", 3.892026, 4.238733, 3.887202],
      ["e93290ca24bc86eac02a1056cf57330b3725242a", 3.889347, 4.214918, 3.917854],
      ["99355a71c9745c5abe950bb0c3863dd2aa4677a0", 3.881602, 4.219853, 3.907431],
      ["c862a82f12c6a10192198cec92d11c0d01b82e4b", 3.886981, 4.233464, 3.915429],
      ["e03fc9a4d3d94e5d3e2a5bbb1ed6c9fb2b50c7bd", 3.880306, 4.217733, 3.902666],
      ["2531de37ccd021569fd53929e5a01c34a9355041", 3.884597, 4.390047, 3.915709],
      ["5e99d25ec226480800baeb455779734a1eaa5c2f", 3.871041, 4.217923, 3.924350],
      ["43886f9b08d0772b54f21a291a0794d060f700f7", 3.894417, 4.203158, 3.909279],
      ["7e5e7ba43cb3044e0df3008cfb4c2fe9a846acc4", 4.907754, 4.210485, 5.057654],
      ["62af73766403aebae50cda75bf908ffc7553dee7", 4.887563, 4.220549, 5.046889],
      ["0737a433b7ec8092633860f5d3d7c290af74bb0c", 4.889106, 4.213205, 5.047751],
      ["8a566091e734427b291cc5832f7612ad76443b36", 4.887272, 4.216758, 5.040767],
      ["9bd65603cddf27ffe161fc590af922265eea3f41", 4.875169, 4.236619, 5.052533],
      ["75a62f263e39115c9c92d50b25782ed7386f0329", 4.880838, 4.226183, 5.078816],
      ["2f042fb3525d0beb24841e1e0c00c45220bebc9a", 4.870644, 4.225939, 5.070287],
      ["161af74112c5a7674a08e99df7161424eeae10a6", 5.048926, 4.378018, 5.223259],
      ["f086b7e79f811b9fdaa975774937d7ea1d0d1b72", 5.078002, 4.411902, 5.253474],
      ["34e37e1899c7c5f0fd7d71308218de8e1c635cb0", 4.866615, 4.205846, 5.048588],
      ["bc6af40051b1187ab6b52d23d75102e103857e28", 5.064326, 4.429129, 5.250805],
      ["4a486c90663e26ffff574a78fd317716684932d7", 4.885643, 4.213927, 5.041719],
      ["472658fda7f3a95f1fb9da9307729f17e9083bf8", 4.874117, 4.240554, 5.389618],
      ["8e92201e4f0c8c1012bbbf44db86711f39851309", 4.858317, 4.232918, 5.381403],
      ["935a262e1589b3ddc4ddc673dd07bd8f91a3f7e6", 4.866946, 4.219988, 5.044345],
      ["00c7af7d090950656fd17ecad2e75f57117bd3b4", 4.875544, 4.204118, 5.054620],
      ["2c53cd151ecc4f2b529861913daf121d202e00e2", 4.860514, 4.221549, 5.055014],
      ["bda63b3e0af52568042594e993b6bff1ccc0b363", 4.876063, 4.226347, 5.064623],
      ["74109d313e374ee25d56bf338c6f7ea01e23a731", 4.865456, 4.235324, 5.055610],
      ["cd0c5cef973edc8ab8df1c1094cb6c3113975951", 4.864728, 4.253148, 5.053614],
      ["c8b3618b0418b3db8a146dd5ace2358df49de8e1", 4.854431, 4.243737, 5.385381],
      ["6afc39bd33cbd52cba9289803a98a015a2bbcf0e", 4.856479, 4.210009, 5.413883],
      ["c8b365128f675da4d130cb65fd7aae07874f7918", 4.851715, 4.220805, 5.405464],
      ["b8bd824738e7c2fa2d6acfc805c1bb90c013be83", 4.872618, 4.227344, 5.418222],
      ["104fe8d8b080a218817dc38aa6be134957a7de76", 4.856949, 4.211376, 5.423370],
      ["8f9cdbf3fa2f036392fce5dba47b85a71fad3c90", 4.891256, 4.207941, 5.442550],
      ["aa86691e80d2222df1d86b99f949e999c47e0eb1", 4.853161, 4.241235, 5.421133],
      ["3e77e1d18597f04b3eeb93d78f593bad9834c889", 4.870204, 4.272354, 5.379283],
      ["6d0984db41f267c17d0db058b3359e4eaa21a118", 4.880563, 4.214223, 5.422132],
      ["54e9b6b72f34090405fa8f9e05ab22654f9d662f", 4.861767, 4.228409, 5.396831],
      ["13913f9ef61b04d956355b4a8fccd8efec1255fe", 4.873595, 4.213172, 5.388901],
      ["4eb42b8dc1e8b05acfa99e941134c67ee5152e59", 4.872827, 4.230502, 5.439097],
      ["33a55ffb20c45820f0d5a6b4826f098559e0edf8", 4.856703, 4.241104, 5.393429],
      ["34880f08f1f3def76be0ea9243df20dec3f9ae16", 4.858992, 4.209518, 5.389819],
      ["b16dbe3f0537d34f1029594c030ff95556c77196", 4.892476, 4.231853, 5.441920],
      ["6e7f003bb604b8f6088cebea12b46b8c9ec78649", 4.864558, 4.231431, 5.413614],
      ["e74f530212122db9acb442ee968a1a88d7f305f7", 4.890227, 4.274430, 5.423606],
      ["c6c12ea45f615b7bd65c365c9a00ab11e904a168", 4.880621, 4.226011, 5.403185],
      ["4f397d55d895c4b16b64e2f25edb9369b26ff895", 4.885928, 4.234113, 5.381661],
      ["b4fc0ebf751492157307a86e3e54bc56797419a5", 4.898393, 4.231434, 5.384382],
      ["13f1ab693ca056698a370c65b8d139faed782261", 4.878608, 4.218127, 5.385777],
      ["6cb0bed424e9e0dcb6b8c8c2a0d1b521540c0067", 2.874342, 2.226392, 3.418615],
      ["23ee5265e48e941f5a5e0a11ebf28362ad238f60", 2.868802, 2.232132, 3.417772],
      ["d4b298b37b83733490f70807991fdf0b44eb1a62", 2.860245, 2.218334, 3.407665],
      ["497d967ce5727f6ac41380a96904e95f6d14c5ba", 2.895776, 2.223309, 3.411666],
      ["f116277043ebad7c0814d7b1a3e1d75f2ddece39", 2.869251, 2.226534, 3.407933],
      ["86ca7d442f50bcbfdfa91c9338821b437041a353", 5.011925, 2.023495, 3.739375],
      ["214a354b219f351a9fb16e87a067bbf29dda1a2c", 2.955770, 2.022342, 3.745777],
      ["80340e87ac1c764555f26a16d7ac4dfd39b66313", 2.868917, 2.213983, 3.403983],
      ["595c1f44e58f043e7c005116931a037112984f3a", 2.968736, 2.027144, 3.736041],
      ["822de236f764747eff02fdc86cd7a462f248a28d", 2.975003, 2.040501, 3.758824],
      ["fcfeb12db2bea3535489cd1d432b1249237052c9", 2.969830, 2.027432, 3.764273],
      ["15ce31f9948593cacf251be3e05eb01ef9d9c86e", 2.999644, 2.053916, 3.782821],
      ["90d786ce2f1f73f4b3a38d9df4cfdb2f3653eb5f", 2.996402, 2.055301, 3.784831],
      ["338569455cf55315915513bdd06451c6cac45f01", 3.006395, 2.056413, 3.779590],
      ["7c81685d4b1b179312b872dc918c6e0f98db9486", 2.958990, 2.017443, 3.739120],
      ["159d5f38e58e1738e551fbfa32ef0ba85c40d1f3", 2.955126, 2.009852, 3.747559],
      ["8be3615955b18454792f66130b4238b1d34ee7eb", 2.961138, 2.018211, 3.739120],
      ["a8243dd366ab0e94ef8db1c02a009bf2fa5f3f64", 2.953039, 2.014701, 3.741622],
      ["4f40cdc39c136c381dc5ce951b5f244dc0c81603", 2.957291, 2.024651, 3.745441],
      ["952f3df6afa27e6e93786f8be59d6b158cef6e1c", 2.964241, 2.013341, 3.737783],
      ["27af74b99be47f53c2fbf9be3538790896ce5264", 2.963405, 2.015402, 3.735280],
      ["c9be2a33dec91c0dc7f95128256a11b8ea6856ff", 2.997805, 2.055842, 3.761751],
      ["5ceeec4638f5029243cce12465094cf8d4ab59c4", 2.996342, 2.058766, 3.764098],
      ["f5b77a390e12766160cefb8d1cdbdcd71a3e9d59", 3.001102, 2.058149, 3.761627],
      ["a8af9e99c892599ba03267ba09df282542e1ca3e", 3.014810, 2.058585, 3.765133],
      ["52bd18633974f2f119e9b99420bfe201cd622fef", 3.024687, 2.081073, 3.779906],
      ["e74bf923e0b9608b47c268852668968fe3d9a1b4", 2.960105, 2.013686, 3.722889],
      ["635fc518bc645bb1e80c6b8b47888687ee3b4c0b", 2.964717, 2.017610, 3.717038],
      ["7ed6df2f3762faf6875e5c3d80a807391a41869a", 2.960449, 2.012286, 3.716940],
      ["3165aa89efe746cb0aed7e8b0ef65f580a9ae79f", 2.960797, 2.015287, 3.716353],
      ["308a1a4f74c7c86001a37183e870dbe3ec6e583a", 2.957707, 2.024121, 3.713376],
      ["a9814bc0c155762fbef0cfdf778fb610808e4078", 2.970298, 2.020455, 3.713241],
      ["4e1c9a74e9917ee6ffec99de406db91ce4c116e2", 2.973316, 2.024078, 3.717697],
      ["e5283addb9cd932c10cd53687f4e4905238a0aeb", 2.958336, 2.016854, 3.721910],
      ["1e8ee0f72e01a3ba2ff056ecb6ff83a781367ebb", 2.963074, 2.011984, 3.725706],
      ["b31f1c4d3a86a822462b57eb8bd71a0c351b9387", 2.965595, 2.020228, 3.722413],
      ["87cc25ec06ab4228e1913518fe0b3d788f9b5494", 2.967945, 2.025708, 3.717279],
      ["bb3bb126d016ca910d0f6e5ae77b98309ff48196", 2.959822, 2.018071, 3.716182],
      ["eacd08a55a7a55a99f37480e3587a11b3e99decc", 2.963644, 2.025092, 3.724415],
      ["c67cb794cc95e9e6517089b45a27b535366f5ea1", 2.985443, 2.018516, 3.747565],
      ["376ec39f99f194a4e116763ba2cc6234445d014b", 2.968660, 2.013825, 3.725117],
      ["fa534101f73ffb469e045644683e9d91aa9f0c22", 2.960066, 2.017654, 3.714708],
      ["24a05c2bbcb6972df4047f7a1332737cacfbfa96", 2.964194, 2.007934, 3.724442],
      ["f91281e7d95b0140fd957b9dadfe1b485d1ffd2a", 2.961492, 2.017142, 3.715778],
      ["f83ba727c170639f9efb0dfaa5159b00487e263d", 2.957380, 2.022456, 3.740356],
      ["fff69a7f78490a4c25b2431d8ed33df7d50aa336", 2.960490, 2.027357, 3.740281],
      ["a84d8771994fc4ee4a4661c6a6be011c03185ccc", 2.961467, 2.019988, 3.746856],
      ["6650718bcae611b7722d2c2dacee37aa33fa5319", 2.957795, 2.016136, 3.740518],
      ["1e56553ae2fd86df53006490f664154438f74267", 2.963831, 2.017139, 3.740130],
      ["4c05a3435346fdb90699c310deac12abf64ca151", 2.966509, 2.023210, 3.748340],
      ["564c277a0ff0b3230e824e93d410a53e06995ad1", 2.959476, 2.021491, 3.746678],
      ["f4c0a21171fec31cee24dfd0834c6760f6f780ce", 2.965072, 2.019965, 3.750775],
      ["d4ad35740ed13c09ddecdd9b4dfbd9735a7006ea", 2.962838, 2.018163, 3.724021],
      ["b83bccacc320877c952fd23dbc231c48ebc2096b", 2.965543, 2.020035, 3.754843],
      ["b8d943e4a4b7107b6d7221e012a1b8d03bda6d7c", 2.973731, 2.028645, 3.751517],
      ["ba8119f7c7e49092f9e7bd70b5c73dd2cb85097e", 2.964723, 2.011412, 3.720742],
      ["3c4f402a22ddf0df1aa84c4e9b89306784a5852b", 2.962860, 2.016578, 3.743910],
      ["99c4618bfe32dfd9caee6287c1d96e45e3a6e0b2", 2.970008, 2.022417, 3.751997],
      ["18105f62bacf8d25bcf06308ac7e4e886bae47b1", 2.967468, 2.020005, 3.746565],
      ["c62768f270dcfcf4bf8fce2a13c2a4986a07e4da", 2.968237, 2.027751, 3.745288],
      ["7d9876c310fc1e3c91a113c138bee2fc9b8cacb5", 2.964734, 2.036793, 3.752784],
      ["cebaadb9a1cd3cb5991b4a53f01edb40ef8cea1d", 2.979919, 2.021649, 3.723353],
      ["0e86170d2723b756433654a6faf236faca9034bc", 2.966366, 2.025738, 3.720976],
      ["89108c0c3e4ea0c97072d6a73612111db1be95dd", 2.975955, 2.023907, 3.750235],
      ["e1c6a2c18d848ac888db8df4f22795201dcb9d8a", 2.969356, 2.024046, 3.756294],
      ["206b625d3844c36f5f7bc9b4d1fb911daf90ea9d", 2.974799, 2.024329, 3.752738],
      ["0843765b7aaaef4e29dfd32f84b94bd336694f1d", 2.971056, 2.020613, 3.751976],
      ["264d9b1ec5037f5ce89f3db6a564304b1ad3496e", 2.970820, 2.026575, 3.733275],
      ["c44c80bb071cc1cfb8cad70b078cd9d88cf21a19", 2.965927, 2.085084, 3.730923],
      ["443766d199be405349466afb0fce42ff33b9efd7", 2.971018, 2.017154, 3.729418],
      ["d6e949e989496e124092273b6ab4e69f92f9c2e2", 2.971710, 2.014317, 3.727408],
      ["7a0a34c632414df081cd16bba3e0d59bc14e4e65", 2.975127, 2.025977, 3.723680],
      ["6023b7ecebd6f1b656ad11d9f51fedda01cdf15f", 2.964539, 2.012575, 3.719941],
      ["39afbd583b6193772b03b6b9e9dc5e39c4ab4cbb", 2.969040, 2.023860, 3.721124],
      ["c5f6946203addda873ee473ece3479dbf9bec2af", 2.983822, 2.020542, 3.720929],
      ["e33613917a615366346ce0710046723be41d688a", 2.970179, 2.016712, 3.719732],
      ["4c0d6d5bd972b93fc9db1ce6fcb83268caf5b6e5", 2.966338, 2.017422, 3.725272],
      ["1ad63c0bb0bf51fca2b878beb166818515d70ed3", 2.966147, 2.040306, 3.724233],
      ["b29602da3e3e767ec968b8cd9aa79f2d7d8b22e5", 2.971299, 2.020640, 3.732414],
      ["25fc6567630de415b7863fcbc413640e8d5e1836", 2.968455, 2.024658, 3.744916],
      ["b0b09ab51194239e4ef4364165d7c96d09e390e1", 2.964912, 2.030856, 3.754623],
      ["f50330594c1bf38067e40d42a853a350cf7c7d22", 2.966161, 2.021342, 3.717740],
      ["91dc40b95b5715b903cf6a68270476b1a9f0dbd8", 2.985852, 2.023497, 3.750687],
      ["65c3e69e9375ef571668de7512d6201827554426", 2.973592, 2.022361, 3.748559],
      ["059cd50158c696a021d9efdf3e9ef92d90dac5ca", 3.018297, 2.022996, 3.748312],
      ["19837b6b56dbabef673defbc942443787af8e580", 2.972394, 2.019595, 3.751082],
      ["3e7572f56274b22c6d12c4a9904589604634d3ab", 2.967340, 2.016821, 3.749741],
      ["f626d77f1177928ae2e4878a677edd290ed661a4", 2.960301, 2.029338, 3.755446],
      ["5568af3bb0ce034f73192d35648c4bf859c89b12", 2.958548, 2.025064, 3.745838],
      ["e37a611763a64405af5f25d68744f14e05435e6f", 3.432558, 2.469488, 4.167366],
      ["7b25302f0c7ce50a74f6fe4c0d0486046501b082", 2.965658, 2.016821, 3.745114],
      ["75ad1b0463146696be580ddb061fe4f3124251fd", 3.425921, 2.461033, 4.183485],
      ["cc92da1ed30ef979c633113f8b436707d337bf03", 2.967511, 2.026299, 3.723113],
      ["38f2a59dcf60d9e5520d95eb54c8555f09308e6f", 2.966708, 2.011762, 3.720341],
      ["a924f1aa0e4ddeb0a200df607957d160db07d31f", 3.401837, 2.465051, 4.191990],
      ["447342780807ddabd48b854627af2f2445db29b7", 2.962129, 2.021868, 3.716301],
      ["cd149d2730988dec43fa0f5238b263b7d98af38b", 3.229680, 2.292136, 4.013083],
      ["846602a76a5e496a6b60257065184299b5db9f88", 3.271459, 2.315252, 4.023805],
      ["4e160506c5834bf1991b1a717ad48280a2dbd56a", 3.410153, 2.474941, 4.191427],
      ["08ca63a3959efeb149cec6931b8dedecffa6c624", 3.406785, 2.484412, 4.174979],
      ["720a095370edd04bfb6689cdf5e07e846dbf42cb", 3.415351, 2.460416, 4.196359],
      ["e4f07b0e7e9df0eda56db34e93415858a9735fd3", 3.412915, 2.479310, 4.188517],
      ["b81187f8e7128b432a684334c7a71aa6b0847390", 3.404493, 2.469129, 4.187888],
      ["90f201ccdcd764aee1b51eaab44d03976513cc7a", 3.409237, 2.462857, 4.181515],
      ["84c84c42a4c09cc4b0bd3cb90a5717727634f423", 3.419543, 2.466621, 4.188022],
      ["e2e3024699c9569cdf75c9f916ddd1ca9347cd46", 3.403864, 2.472878, 4.181911],
      ["7d7175defaceba131e03bc4b1ffc73012cfe98e3", 3.410865, 2.487102, 4.192813],
      ["2614c541563cd9cfb3e2f4003784ada4066d847f", 3.416183, 2.464766, 4.198776],
      ["73e6b835e9d4f183393ed1f3c28c0de710165c67", 3.448530, 2.474781, 4.228883],
      ["5031363fbf4a05cb779319a8886437150ae6cd4e", 3.422489, 2.462190, 4.192160],
      ["e8cf444412eb9063b6117c7a46334009603e7335", 3.420837, 2.462999, 4.206206],
      ["7900108972268d580f31c0157112206efc3d8028", 3.406970, 2.462535, 4.195542],
      ["8d94db1aa6ee6b8e84c7afff1db7894a303f06fb", 3.436611, 2.463494, 4.216776],
      ["07c77127a700f49799933a6fc3fa1aa5ad5e2a1c", 3.431828, 2.483441, 4.200928],
      ["dd489ddcd58ee6f4f799bca6c2f6bedcf1264e69", 3.401878, 2.478947, 4.192330],
      ["e40c3ae722955952511ba6ce60ae271657ee0dae", 3.419929, 2.463213, 4.228332],
      ["be0ae2b6f345d5533cee1297c72b7f55a0cf535c", 3.405376, 2.469362, 4.222262],
      ["e31b594d79ed94d2da87119c3f5c6ed60baee178", 3.430546, 2.461133, 4.189068],
    ]);

    // Set chart options
    var options = {
                    'title':'Ag benchmark',
                    'fontSize': 20,
                    'chartArea': {
                      'left': 70,
                      'top': 50,
                      'width': 600
                    },
                    'legend': {
                      'position': 'bottom'
                    },
                    'vAxis': {
                      'minValue': 0,
                      'title': 'Seconds'
                    },
                    'width':672,
                    'height':500
                  };

    // Instantiate and draw our chart, passing in some options.
    var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
    chart.draw(data, options);
  }
</script>

<div id="chart_div" style="width: 672px; height: 500px;"> </div>

For comparison, grep -r takes 11 seconds. Ack takes 20 seconds.

Here's the script I wrote to generate the data:

{% highlight bash %}
#!/bin/bash

function benchmark_rev() {
    REV=$1
    git checkout $REV &> /dev/null
    if [ $? -ne 0 ]; then
        echo "Checkout of $REV failed!"
        exit 1
    fi
    ./build.sh &> /dev/null
    if [ $? -ne 0 ]; then
        echo "Build failed!"
    fi

    # grep to filter out occasional debugging lines I printed out
    TIME1=`./ag --stats blahblahblah ~/code/ 2>&1 | grep seconds | tail -n 1 | awk '{print $1}'`
    TIME2=`./ag --stats blah.*blah ~/code/ 2>&1 | grep seconds | tail -n 1 | awk '{print $1}'`
    TIME3=`./ag --stats -i blahblahblah ~/code/ 2>&1 | grep seconds | tail -n 1 | awk '{print $1}'`
    echo "[\"$REV\", $TIME1, $TIME2, $TIME3],"
}

# 6a38fb74 is the first rev that supports --stats
REV_LIST=`git rev-list 6a38fb74..master`

for rev in $REV_LIST; do
    benchmark_rev $rev
done
{% endhighlight %}

I ran three benchmarks on each revision: Case-sensitive string matching, regular expression matching, and case-insensitive string matching. The results were surprising. 


---
layout: standalone
status: publish
title: Countdown
stylesheet: countdown
---

<div class="countdown_display">
  <div class="">
    <input id="datetime_picker" name="datetime_picker" type="datetime-local" />
  </div>
  <div class="title">
    T-0: <span class="when"></span>
  </div>
  <div class="digits">
    <div class="digit">
      <div class="t">T</div>
    </div>
    <div class="digit">
      <div class="sign"></div>
      <div class="plus"></div>
    </div>
  </div>
  <div class="digits day">
    <div class="digit">
      <div class="segment a">
        <div class="bottom"></div>
      </div>
      <div class="segment b">
        <div class="left"></div>
      </div>
      <div class="segment c">
        <div class="left"></div>
      </div>
      <div class="segment d">
        <div class="top"></div>
      </div>
      <div class="segment e">
        <div class="right"></div>
      </div>
      <div class="segment f">
        <div class="right"></div>
      </div>
      <div class="segment g">
        <div class="top"></div>
        <div class="bottom"></div>
      </div>
    </div>
    <div class="digit">
      <div class="segment a">
        <div class="bottom"></div>
      </div>
      <div class="segment b">
        <div class="left"></div>
      </div>
      <div class="segment c">
        <div class="left"></div>
      </div>
      <div class="segment d">
        <div class="top"></div>
      </div>
      <div class="segment e">
        <div class="right"></div>
      </div>
      <div class="segment f">
        <div class="right"></div>
      </div>
      <div class="segment g">
        <div class="top"></div>
        <div class="bottom"></div>
      </div>
    </div>
  </div>
  <div class="colon day">
    <div class="top"></div>
    <div class="bottom"></div>
  </div>
  <div class="digits hour">
    <div class="digit">
      <div class="segment a">
        <div class="bottom"></div>
      </div>
      <div class="segment b">
        <div class="left"></div>
      </div>
      <div class="segment c">
        <div class="left"></div>
      </div>
      <div class="segment d">
        <div class="top"></div>
      </div>
      <div class="segment e">
        <div class="right"></div>
      </div>
      <div class="segment f">
        <div class="right"></div>
      </div>
      <div class="segment g">
        <div class="top"></div>
        <div class="bottom"></div>
      </div>
    </div>
    <div class="digit">
      <div class="segment a">
        <div class="bottom"></div>
      </div>
      <div class="segment b">
        <div class="left"></div>
      </div>
      <div class="segment c">
        <div class="left"></div>
      </div>
      <div class="segment d">
        <div class="top"></div>
      </div>
      <div class="segment e">
        <div class="right"></div>
      </div>
      <div class="segment f">
        <div class="right"></div>
      </div>
      <div class="segment g">
        <div class="top"></div>
        <div class="bottom"></div>
      </div>
    </div>
  </div>
  <div class="colon">
    <div class="top"></div>
    <div class="bottom"></div>
  </div>
  <div class="digits minute">
    <div class="digit">
      <div class="segment a">
        <div class="bottom"></div>
      </div>
      <div class="segment b">
        <div class="left"></div>
      </div>
      <div class="segment c">
        <div class="left"></div>
      </div>
      <div class="segment d">
        <div class="top"></div>
      </div>
      <div class="segment e">
        <div class="right"></div>
      </div>
      <div class="segment f">
        <div class="right"></div>
      </div>
      <div class="segment g">
        <div class="top"></div>
        <div class="bottom"></div>
      </div>
    </div>
    <div class="digit">
      <div class="segment a">
        <div class="bottom"></div>
      </div>
      <div class="segment b">
        <div class="left"></div>
      </div>
      <div class="segment c">
        <div class="left"></div>
      </div>
      <div class="segment d">
        <div class="top"></div>
      </div>
      <div class="segment e">
        <div class="right"></div>
      </div>
      <div class="segment f">
        <div class="right"></div>
      </div>
      <div class="segment g">
        <div class="top"></div>
        <div class="bottom"></div>
      </div>
    </div>
  </div>
  <div class="colon">
    <div class="top"></div>
    <div class="bottom"></div>
  </div>
  <div class="digits second">
    <div class="digit">
      <div class="segment a">
        <div class="bottom"></div>
      </div>
      <div class="segment b">
        <div class="left"></div>
      </div>
      <div class="segment c">
        <div class="left"></div>
      </div>
      <div class="segment d">
        <div class="top"></div>
      </div>
      <div class="segment e">
        <div class="right"></div>
      </div>
      <div class="segment f">
        <div class="right"></div>
      </div>
      <div class="segment g">
        <div class="top"></div>
        <div class="bottom"></div>
      </div>
    </div>
    <div class="digit">
      <div class="segment a">
        <div class="bottom"></div>
      </div>
      <div class="segment b">
        <div class="left"></div>
      </div>
      <div class="segment c">
        <div class="left"></div>
      </div>
      <div class="segment d">
        <div class="top"></div>
      </div>
      <div class="segment e">
        <div class="right"></div>
      </div>
      <div class="segment f">
        <div class="right"></div>
      </div>
      <div class="segment g">
        <div class="top"></div>
        <div class="bottom"></div>
      </div>
    </div>
  </div>
  <div class="decimal">
    <div class="bottom"></div>
  </div>
  <div class="digits millisecond">
    <div class="digit">
      <div class="segment a">
        <div class="bottom"></div>
      </div>
      <div class="segment b">
        <div class="left"></div>
      </div>
      <div class="segment c">
        <div class="left"></div>
      </div>
      <div class="segment d">
        <div class="top"></div>
      </div>
      <div class="segment e">
        <div class="right"></div>
      </div>
      <div class="segment f">
        <div class="right"></div>
      </div>
      <div class="segment g">
        <div class="top"></div>
        <div class="bottom"></div>
      </div>
    </div>
    <div class="digit">
      <div class="segment a">
        <div class="bottom"></div>
      </div>
      <div class="segment b">
        <div class="left"></div>
      </div>
      <div class="segment c">
        <div class="left"></div>
      </div>
      <div class="segment d">
        <div class="top"></div>
      </div>
      <div class="segment e">
        <div class="right"></div>
      </div>
      <div class="segment f">
        <div class="right"></div>
      </div>
      <div class="segment g">
        <div class="top"></div>
        <div class="bottom"></div>
      </div>
    </div>
  </div>

</div>

<script type="text/javascript">
var days,
  days_0_s,
  days_1_s,
  hours,
  hours_0_s,
  hours_1_s,
  milliseconds,
  milliseconds_0_s,
  milliseconds_1_s,
  minutes,
  minutes_0_s,
  minutes_1_s,
  plus,
  seconds,
  seconds_0_s,
  seconds_1_s,
  when,
  when_str,
  segment_lookup,
  sign,
  picker;

picker = document.getElementById("datetime_picker");

segment_lookup = [
  [1, 1, 1, 1, 1, 1, 0],
  [0, 1, 1, 0, 0, 0, 0],
  [1, 1, 0, 1, 1, 0, 1],
  [1, 1, 1, 1, 0, 0, 1],
  [0, 1, 1, 0, 0, 1, 1],
  [1, 0, 1, 1, 0, 1, 1],
  [1, 0, 1, 1, 1, 1, 1],
  [1, 1, 1, 0, 0, 0, 0],
  [1, 1, 1, 1, 1, 1, 1],
  [1, 1, 1, 1, 0, 1, 1],
];

if (location.hash) {
  when_str = decodeURIComponent(location.hash.slice(1));
  when = new Date(when_str);
} else {
  when = new Date();
  when.setHours(0);
  when.setMinutes(0);
  when.setSeconds(0);
  when.setMilliseconds(0);
  when.setDate(when.getDate() + 1);
}

function pad (num, size) {
  var s = "00000000000000000000000000000000" + num;
  return s.substr(s.length - size);
}

// TODO: hide picker if no activity
function setPicker (dateTime) {
  // Picker needs YYYY-MM-DDThh:mm
  var whenStr = pad(when.getFullYear(), 4) + "-" + pad(when.getMonth() + 1, 2) + "-" + pad(when.getDate(), 2) + "T" + pad(when.getHours(), 2) + ":" + pad(when.getMinutes(), 2);
  picker.value = whenStr;
}
setPicker(when);

function updateDate (e) {
  console.log("new value", e, picker.value);
  if (!picker.value) {
    console.error("no value", e);
    return;
  }
  when = new Date(picker.value);
  document.getElementsByClassName("when")[0].innerHTML = date_format(when);
  location.hash = when.toISOString();
}

picker.onchange = updateDate

function lead_zero(i) {
  return i < 10 ? "0" + i : i;
}

function date_format(d) {
  var str = "";
  str += d.getUTCFullYear() + "-" + lead_zero(d.getUTCMonth() + 1) + "-" + lead_zero(d.getUTCDate());
  str += " ";
  str += lead_zero(d.getUTCHours()) + ":" + lead_zero(d.getUTCMinutes()) + ":" + lead_zero(d.getUTCSeconds());
  return str + " UTC";
}

document.getElementsByClassName("when")[0].innerHTML = date_format(when);

sign = document.getElementsByClassName("sign")[0];
plus = document.getElementsByClassName("plus")[0];

days = document.getElementsByClassName("day")[0].getElementsByClassName("digit");
days_0_s = days[0].getElementsByClassName("segment");
days_1_s = days[1].getElementsByClassName("segment");

hours = document.getElementsByClassName("hour")[0].getElementsByClassName("digit");
hours_0_s = hours[0].getElementsByClassName("segment");
hours_1_s = hours[1].getElementsByClassName("segment");

minutes = document.getElementsByClassName("minute")[0].getElementsByClassName("digit");
minutes_0_s = minutes[0].getElementsByClassName("segment");
minutes_1_s = minutes[1].getElementsByClassName("segment");

seconds = document.getElementsByClassName("second")[0].getElementsByClassName("digit");
seconds_0_s = seconds[0].getElementsByClassName("segment");
seconds_1_s = seconds[1].getElementsByClassName("segment");

milliseconds = document.getElementsByClassName("millisecond")[0].getElementsByClassName("digit");
milliseconds_0_s = milliseconds[0].getElementsByClassName("segment");
milliseconds_1_s = milliseconds[1].getElementsByClassName("segment");

function render_digit(segments, digit) {
  var i,
    values = segment_lookup[digit];

  for (i = 0; i < values.length; i++) {
    if (values[i]) {
      segments[i].classList.add("on");
    } else {
      segments[i].classList.remove("on");
    }
  }
}

function render() {
  var now = Date.now(),
    r;

  if (now > when) {
    r = new Date(now - when);
    plus.classList.add("on");
  } else {
    r = new Date(when - now);
    plus.classList.remove("on");
  }

  var dayValue = Math.floor(r.valueOf() / 1000 / 3600 / 24);
  var daysElems = document.getElementsByClassName("day");
  if (dayValue > 0) {
    render_digit(days_0_s, Math.floor(dayValue / 10));
    render_digit(days_1_s, dayValue % 10);
    for (var i = 0; i < daysElems.length; i++) {
      daysElems[i].style = "";
    }
  } else {
    for (var i = 0; i < daysElems.length; i++) {
      daysElems[i].style = "display: none;";
    }
  }

  render_digit(hours_0_s, Math.floor(r.getHours() / 10));
  render_digit(hours_1_s, r.getHours() % 10);

  render_digit(minutes_0_s, Math.floor(r.getMinutes() / 10));
  render_digit(minutes_1_s, r.getMinutes() % 10);

  render_digit(seconds_0_s, Math.floor(r.getSeconds() / 10));
  render_digit(seconds_1_s, r.getSeconds() % 10);

  render_digit(milliseconds_0_s, Math.floor(r.getMilliseconds() / 100));
  render_digit(milliseconds_1_s, Math.floor((r.getMilliseconds() % 100) / 10));
}

render_digit(hours_0_s, 8);
render_digit(hours_1_s, 8);
render_digit(minutes_0_s, 8);
render_digit(minutes_1_s, 8);
render_digit(seconds_0_s, 8);
render_digit(seconds_1_s, 8);
render_digit(milliseconds_0_s, 8);
render_digit(milliseconds_1_s, 8);

function rfa() {
  render();
  window.requestAnimationFrame(rfa);
}

setTimeout(rfa, 1000);

</script>
